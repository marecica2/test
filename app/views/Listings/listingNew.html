#{extends 'main.html' /} 

#{set 'moreScripts'}
	<script src="@{'/public/javascripts/lib/bootstrap-timepicker.min.js'}" type="text/javascript"></script>
	<script src="@{'/public/javascripts/lib/simpleWebRtc.js'}" type="text/javascript" ></script>
	<script src="@{'/public/javascripts/lib/bootstrap-datepicker.js'}" type="text/javascript"></script>	
	<script src="@{'/public/javascripts/lib/jquery.Jcrop.min.js'}"></script>
	<script src="@{'/public/javascripts/utils.js'}" type="text/javascript"></script>	
	<script>
		starInit.aspectRatio = 2.5;
		#{if listing}
			starInit.event = "${listing.uuid}" 
		#{/if}
        #{else}
        	starInit.temp = "${temp}";
        #{/else}	
        
        #{if event}
			starInit.event = "${event.uuid}" 
		#{/if}
		#{else}
			starInit.temp = "${temp}";
		#{/else}	
	</script>	
	<script src="@{'/public/javascripts/utils.js'}" type="text/javascript"></script>	
	<script src="@{'/public/javascripts/starEvent.js'}" type="text/javascript"></script>	
	<script src="@{'/public/javascripts/upload.js'}" type="text/javascript"></script>	
	<script type="text/javascript" src="@{'/public/javascripts/lib/bootstrap-timepicker.min.js'}"></script>
	#{if listing}
	<script>
		$(document).ready(function(){
			starInit.listing = "${listing.uuid}";
			var now = (new Date(new Date().getTime())).toJSON();
			var params = "&start="+now+"&end="+now+"&listing="+starInit.listing+"&direction=upcoming&type=listing";
			star.initItems("Upcoming", params);
	
			var params1 = "&start="+now+"&end="+now+"&listing="+starInit.listing+"&direction=previous&type=listing";
			star.initItems("Previous", params1);
		});
	</script>			
	#{/if}
#{/set}


#{set 'moreStyles'}
    <link href="@{'/public/css/bootstrap-timepicker.min.css'}" rel="stylesheet" media="screen"/>
    <link rel="stylesheet" type="text/css" href="@{'/public/css/tags.css'}" />
	<link rel="stylesheet" href="@{'/public/css/jquery.Jcrop.min.css'}" type="text/css" />
    <style>
    	.vertical-divider-right {
			padding-right: 15px !important;
    	}	
    </style>
#{/set}

<!-- set the item object -->
#{if fromEvent && event}
	#{set item:event /}
#{/if}
#{else}
	#{set item:listing /}
#{/else}

#{if listing}
	#{set usr:listing.user /} 
#{/if}
#{else}
	#{set usr:user /} 
#{/else}




<div class="section gray-bg" style="padding-top:15px;padding-bottom:15px">
	<div class="container">
	   	#{if listing}
	   	<div class="pull-left">
		   	<h3 style="margin-top:10px">
		   		<a href="/channels?category=${listing.category}" class="anchor"><i><strong>${listing.category.capAll()}</strong></i></a> 
		   		/ <i><a class="anchor" href="/channel/${listing.uuid}">${listing.title}</a></i>
		   		#{if event}
			   		<small>
				   		/
				   		<span>${event.eventStart.format("dd MMM, yyyy")}</span>
				   		<span>#{time time:event.eventStart/}</span> - 
				   		<span>#{time time:event.eventEnd/}</span>		   		
				   		<span>(${event.getMinutes()} min) ${event.getTotalPrice()}</span>		   		
			   		</small>
		   		#{/if}
		   	</h3>
	   	</div>
		#{/if}
	   	<div class="pull-right">
			<ul class="social-links colored clearfix" style="margin:0px">
				<li class="default"><a href="" data-toggle="modal" data-target="#myModal" onclick="$('#share-link').select();"><i class="fa fa-link"></i></a></li>
				<li class="twitter"><a target="_blank" href="http://www.twitter.com"><i class="fa fa-twitter"></i></a></li>
				<li class="linkedin"><a target="_blank" href="http://www.skype.com"><i class="fa fa-linkedin"></i></a></li>
				<li class="facebook"><a target="_blank" href="http://www.facebook.com"><i class="fa fa-facebook"></i></a></li>
				<li class="googleplus"><a target="_blank" href="http://plus.google.com"><i class="fa fa-google-plus"></i></a></li>
			</ul>
	   	</div>
	   	<div class="clearfix"></div>
	</div>
</div>


<!-- Modal -->
<div class="modal" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Cancel</span></button>
        <h3 class="modal-title" id="myModalLabel"><i class="fa fa-link"></i> Share</h3>
      </div>
      <div class="modal-body">
      	<input id="share-link" type="text" class="form-control" value="${request.base + request.url}">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default btn-short" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
	
<!-- header -->
<div class="section dark-bg" style="padding:0px;">
	<div class="container">	
		<div class="row" style="border-top:0px solid #{if listing && listing.color} ${listing.color} #{/if} #{else} #3A87AD #{/else};">
			<div class="col-md-12 " style="padding:0px;">
				#{if !edit}
				<div id="image"style="overflow: hidden;width:100%;height:400px;background: url(/${listing.imageUrl}); background-size: cover;text-align:center">
					<div class="shadow-inset" style="height:130%;position:relative;top:-60px;"></div>
					#{if listing && listing.video}
						<a style="position:absolute;top:50%;left:48%" class="anchor-link popup-iframe" href="${listing.video}"><i class="fa fa-youtube-play fa-3x"></i><br/>Play Introduction</a>
					#{/if}
				</div>
				#{/if}
				#{else}
					#{if listing}
						<img id="image" class="shadow-inset" style="width:100%" src="/${listing.imageUrl}">	
					#{/if}
					#{elseif request.params.imageUrl}
						<img id="image" class="shadow-inset" style="width:100%" src="/${request.params.imageUrl}">	
					#{/elseif}
					#{else}
						<img id="image" class="shadow-inset" style="width:100%" src="/public/images/no_image.png">	
					#{/else}
				#{/else}
				
				<!-- edit buttons -->
				<div style="position:absolute;top:15px;right:15px;">
					
					#{if fromEvent}
						#{if event && isOwner && (event.state == 'customer_created' || event.state == 'user_declined')}
							<a class="btn btn-light-gray btn-sm " href='/event-approve?event=${event.uuid}&url=${request.url.urlEncode()}' style="margin:2px;" id="" data-url="/event/approve?event="><i class="fa fa-check"></i> &{'dashboard.approve'}</a>
							<a class="btn btn-light-gray btn-sm " href='/event-decline?event=${event.uuid}&url=${request.url.urlEncode()}' style="margin:2px;" id="" data-url="/event/decline?event="><i class="fa fa-times"></i> &{'dashboard.decline'}</a>				   	
					   	#{/if} 				
						
						#{if event && event.charging && attendance != null}
							#{if attendance.paid == null || !attendance.paid }
								<a href="/paypal/checkout/${event.uuid}?url=${request.url.urlEncode()}" class="btn btn-light-gray btn-sm">
									<i class="dialog-event-edit color-link fa fa-paypal fa-1x"></i> Pay for event now
								</a>
							#{/if}
							#{else}
								<span class="btn btn-default btn-xs shadow">
									<i class="dialog-event-edit color-link fa fa-paypal fa-1x"></i> Paid on ${attendance.transactionDate.format("dd MMM, yyyy")}
								</span>
							#{/else}
						#{/if}
	
						#{if false && event && (attendance == null || !attendance.watchlist)}
							<a href="/watchlist/add?event=${event.uuid}&url=${request.url.urlEncode()}" class="btn btn-light-gray btn-sm">
								<i class="dialog-event-edit color-link fa fa-plus fa-1x"></i> Add to watchlist
							</a>
						#{/if}
						
						#{if false && attendance != null && attendance.watchlist}
							<a href="/watchlist/remove?id=${attendance.uuid}&url=${request.url.urlEncode()}" class="btn btn-light-gray btn-sm">
								<i class="dialog-event-edit color-link fa fa-minus fa-1x"></i> Remove from watchlist
							</a>
						#{/if}
						
						#{if !edit && isOwner}
							<a href="/event?action=edit&uuid=${request.params.uuid}&url=${request.url.urlEncode()}" class="btn btn-light-gray btn-sm">
								<i class="dialog-event-edit color-link fa fa-pencil fa-1x"></i> Edit Event
							</a>
							<a href="/event-delete?uuid=${request.params.uuid}&url=${'/channel/'+listing.uuid.urlEncode()}" onclick="if(confirm('delete?')){return true;} else {return false;}" class="btn btn-light-gray btn-sm">
								<i class="dialog-event-edit color-link fa fa-times fa-1x"></i> Delete Event
							</a>
						#{/if}
						
						#{if edit}
							<a href="${request.params.url}" class="btn btn-light-gray btn-sm">
								Cancel
							</a>		
						#{/if}	
								
					#{/if}	
					#{else}	 
						#{if !edit && isOwner}
							#{if user.isPublisher()}
							<a href="/event?action=edit&url=${request.url.urlEncode()}&listingId=${listing.uuid}" class="btn btn-light-gray btn-sm">
								<i class="color-link fa fa-plus fa-1x"></i> Create Event
							</a>
							#{/if}
							<a href="/channel/${listing.uuid}?action=edit&url=${request.url.urlEncode()}" class="btn btn-light-gray btn-sm">
								<i class="color-link fa fa-pencil fa-1x"></i> Edit Channel
							</a>
							<a href="/channel-delete?uuid=${listing.uuid}" class="btn btn-light-gray btn-sm" onclick="if(confirm('delete?')){return true;} else {return false;}">
								<i class="color-link fa fa-times fa-1x"></i> Delete Channel
							</a>
							#{/if}
						#{if edit}
							<a href="${request.params.url}" class="btn btn-light-gray btn-sm">
								Cancel
							</a>		
						#{/if}	
					#{/else}	
				</div>
			</div>
		</div>
	</div>
</div>
<!-- header -->





<!-- edit -->
#{include 'Listings/edit.html' /}
<!-- edit -->



<!-- parallax -->
#{if !edit}
<div class="section parallax light-translucent-bg parallax-bg-3" style="background-position: 50% 116px;padding:15px 0 0 0">
	<div class="container">
		<div class="row">
			<div class="col-md-8">
				<h1 class="title text-center">
					<a class="anchor" href="/channel/${listing.uuid}">${listing.title}</a>		
				</h1>
				<p class="text-center" style="margin:0 0 15px 0">
					<span>
						#{if item && item.charging == 'free'}
							<strong>Free</strong>
						#{/if}
						#{if item && item.charging == 'before'}
							<strong>from ${item.price} ${item.currency}</strong>
							<strong>per ${item.chargingTime} minutes</strong>
							#{if item.firstFree}
								<span class="label default-bg">First Event is free</span>
							#{/if}
						#{/if}	
					</span>				
				</p>
			</div>
			<div class="col-md-4">
				#{if !isOwner}
				<div class="text-center">
					<a href="/user/${usr.login}"><img style="height:61px;" src="/${usr.avatarUrl}_64x64"></a>				
					<a href="/user/${usr.login}/calendar?listing=${listing.uuid}" class="btn btn-default btn-lg"><i class="fa fa-calendar"></i> Request a Time</a>
				</div>
				#{/if}
			</div>
		</div>
	</div>
</div>
#{/if}
<!-- parallax -->


<!-- stream -->
#{include 'Listings/stream.html' /}
<!-- stream -->

	
#{if !edit}
<div class="container">		
	<br/>
	<div class="row">
		<div class="col-md-8 side vertical-divider-right" style="padding-top:0px;margin-right:0px">
			<!-- description -->
			<div>
    	   	   <h2>
					#{if listing}
    	   	   			${listing.title}
	 	    	   	#{/if}
    	   	   	</h2>
    	   	   	<div class="separator-2"></div>
    	   	   	<a href="/user/${listing.user.login}"><img class="avatar16 img-circle" src="/${listing.user.avatarUrl}_32x32"> <span>${listing.user.fullName}</span></a> 
    	   	   	on 
    	   	   	#{if fromEvent}
	    	   	   	${event.created.format("dd MMM, yyyy")}
    	   	   	#{/if}
    	   	   	#{else}
	    	   	   	${listing.created.format("dd MMM, yyyy")}
    	   	   	#{/else}

 	    	   	<small style="font-size:1.0em">
					#{if fromEvent && event}
						
						#{if event.privacy == 'private'}
							<span class="label default-bg"><i class="fa fa-lock" title="${event.privacy}"></i> ${event.privacy}</span>
						#{/if}
						
						#{if event.privacy == 'public'}
							<span class="label label-default"><i class="fa fa-unlock" title="${event.privacy}"></i> ${event.privacy}</span>
						#{/if}
						
						<span class="label label-default"><i class="fa fa-comments" title="${event.type}"></i> ${event.type}</span>

						#{if event.charging != 'free'}
							<span class="label label-default">This Event is paid </span>
						#{/if}					
					#{/if}		 	    	   	
					#{else}
						#{if listing.privacy == 'private'}
							<span class="label label-default"><i class="fa fa-lock" title="${listing.privacy}"></i> ${listing.privacy}</span>
						#{/if}
						
						#{if listing.privacy == 'public'}
							<span class="label label-default"><i class="fa fa-unlock" title="${listing.privacy}"></i> ${listing.privacy}</span>
						#{/if}
						
						<span class="label label-default"><i class="fa fa-comments" title="${listing.type}"></i> ${listing.type}</span>
						
						#{if listing.charging != 'free'}
							<span class="label label-default">This Event is paid </span>
						#{/if}
					#{/else}		    	   
	    	   	</small>
    	   	   	
				<p>${listing.getDescriptionHtml().raw()}</p>
			 	#{if event}
				   <p>
				       <strong>Links</strong><br/>
					   #{if !edit && event}
					       #{if event.type == 'livecast'}
								#{if isOwner && (type == null || type != "broadcast") }
									<a class="btn btn-gray btn-sm btn-margin" href='/event?uuid=${event.uuid}&type=broadcast'><i class="fa fa-arrow-circle-o-right"></i> &{'dashboard.startLivestream'}</a>
								#{/if}
								#{if isOwner && (type != null && type == "broadcast") }
									<a class="btn btn-gray btn-sm btn-margin" href='/event?uuid=${event.uuid}'><i class="fa fa-arrow-circle-o-right"></i> &{'dashboard.stopLivestream'}</a>
								#{/if}
								<a class="btn btn-gray btn-sm btn-margin" href="/event?uuid=${event.uuid}&type=view"><i class="fa fa-eye"></i> &{'dashboard.viewLivestream'}</a>
							#{/if}
							
						   	#{if isOwner && type && type == 'broadcast'}
						   		<a class="btn btn-gray btn-sm btn-margin" href="/event?uuid=${event.uuid}"><i class="fa fa-microphone"></i> Stop</a>
						   	#{/if} 
							
							#{if event.type == 'p2p'}
								<a class="btn btn-gray btn-sm btn-margin" href="/room?id=${event.uuid}&secret=${event.roomSecret}" target="_blank"><i class="fa fa-arrow-circle-o-right"></i> &{'dashboard.joinMeeting'}</a>
							#{/if}
						#{/if}
						<script src="https://apis.google.com/js/platform.js"></script>
						<span id="placeholder-div5"></span>						
						<script>
						  $(document).ready(function(){
							  gapi.hangout.render('placeholder-div5', {
							    'topic': 'cats',
							    'render': 'createhangout',
							    'hangout_type': 'onair',
							    'widget_size': 72
							  });
						  })
						</script>							
		    	   </p>
		    	#{/if}				
    	   		<strong>Tags</strong><br/>
    	   		#{if listing && listing.tags}
	    		    #{set tags = listing.tags.split(",") /}
	    	    	#{list items:tags, as:'tag'}
	    	    		<a href="/channels?search=${tag}" style="font-size:0.8em" class="label label-default">${tag}</a>
	    	    	#{/list}
    	    	#{/if}
			</div>


			<!-- comments -->
			<div>
				<!-- comments -->
				#{if fromEvent}
					#{set object:event /}
					#{include 'comments.html' /}			
				#{/if}
				#{else}
					#{set object:listing /}
					#{include 'comments.html' /}			
				#{/else}
			</div>		
			
			
			<!-- listing events -->
			#{if !fromEvent}
			<br/>
			<br/>
			<div>
				<div class="pull-left" style="width:50%;padding-right:7px">
					<h4>
						<i class="icon-back-in-time"></i>Upcoming Events
					</h4>
					<div id="itemsListUpcoming" class="full-width"></div>
					<div class="spinner-container1">
						<div class="spinner-container">
							<div id="spinnerUpcoming" class="spinner-load"></div>
							<a id="moreResultsUpcoming" class="spinner-more"><i class=" icon-plus-circled"></i></a>
						</div>
					</div>
				</div>
				<div class="pull-left" style="width:50%;padding-left:7px">
					<h4>
						<i class="icon-back-in-time"></i>Recent Events
					</h4>
					<div id="itemsListPrevious" class="full-width"></div>
					<div class="spinner-container1">
						<div class="spinner-container">
							<div id="spinnerPrevious" class="spinner-load"></div>
							<a id="moreResultsPrevious" class="spinner-more"><i class=" icon-plus-circled"></i></a>
						</div>
					</div>
				</div>	
			</div>	
			<div class="clearfix"></div>
			#{/if}
			
			

			<!-- user about -->
			<div>
				<br/>
				<h2><a class="anchor" href="/user/${listing.user.login}"><img class="img-circle" src="/${listing.user.avatarUrl}_32x32"> About ${listing.user.firstName}</a></h2>
				<div class="separator-2"></div>
				#{if listing}
					#{set usr: listing.user /}
				#{/if}		
				#{else}		
					#{set usr: user /}
				#{/else}		
					
				#{include 'userAbout.html' /}
			</div>	
						
			<!-- listings -->
			<div>
				<br/>			
				#{if listings}
					<h2>All channels from ${listing.user.firstName}</h2>
					<div class="separator-2"></div>
					#{set items:listings /}
					#{set forEvents:false /}
					#{include 'listingsList.html' /}
				#{/if}	
			</div>
			<!-- listings -->	

			<!-- ratings -->
			<div>
				<!-- ratings -->
				#{if listing}
					#{set object:listing /}
					#{set ratingType:"listing" /}
				#{/if}
				#{include 'ratings.html' /}				
			</div>		
		</div>
	
	
		<div class="col-md-4">
		
			<!-- invites -->
			#{if fromEvent && !edit}
			<!-- guests -->
			<div>
				<h2>
					<a name="invitation"></a>
					<label style="font-weight:500" for="notify-check-all">&{'dashboard.guests'}</label>
					#{if isOwner}
						<input id='notify-check-all' type='checkbox' style='position:relative;top:2px;' class='notify-check-all' value='all'>
					#{/if}
				</h2>
				
				#{if isOwner}
	 				<form class="" action="/attendance-new-save?eventId=${event.uuid}&url=${request.url.urlEncode()}#invitation" method="post">
					    <div class="input-group" style="width:100%">
							<input type="text" class="form-control" autocomplete="off" placeholder="&{'dashboard.inviteAdd'}" maxlength="50" name="email" id="dialog-invite-input" data-provide="typeahead">
						    <span class="input-group-btn">
						    	<button class="btn btn-default btn-short" style="margin:0px;height:40px" id="dialog-invite-button" type="submit">&{'dashboard.invite'}</button>
						    </span>
					    </div>
						<div class="error">#{error 'email' /}</div>
						<script>
						        $(".notify-check-all").change(function(){
						            if($(this).prop("checked")){
						                $('.notify-checkboxes').prop("checked", true);
						            } else {
						                $('.notify-checkboxes').prop("checked", false);
						            }
						        });
						    				      
							  	$("#dialog-invite-input").typeahead(
							  	{
							  	    minLength : 2, 
							  	    source : function(value, process){
										  	    $.get("/invites?str="+value, function(data){
										  	        var list = [];
											  	    for(var i in data)
												  		list.push(data[i].login +", "+ data[i].name);
										  	        process(list);
										  	    });
							  				},
							  		updater : function(item){
							  		    return item.substring(0, item.indexOf(", "));
							  		}, 
							  		matcher : function(item){
							  		    return true;
							  		}
							  	}
							  	);
						</script>
	  				</form>
					#{/if}					

					#{if event && event.attendances}
	  				<form action="/event/invite?eventId=${event.uuid}&url=${request.url.urlEncode()}" method="post">
						<table class="dialog-invite-list" data-checkboxes="true" style="width:100%">
							#{list items:event.attendances, as:'item'}
							    <tr>
							    	<td>
							    		#{if item.isForUser && item.user != null}
								    		<img class="avatar22 img-circle"  src="/${item.user.avatarUrl}"> <label for="invite${item.uuid}"><a href="/user/${item.user.login}">${item.user.fullName}</a></label>
										#{/if}
										#{elseif item.customer != null}
								    		<img class="avatar22 img-circle"  src="/${item.customer.avatarUrl}"> <label for="invite${item.uuid}"><a href="/user/${item.customer.login}">${item.customer.fullName}</a></label>
										#{/elseif}
										#{else}
								    		<img class="avatar22 img-circle"  src=""> <label for="invite${item.uuid}">${item.email}</label>
										#{/else}
							    		#{if isOwner && (item.user == null || !item.isForUser)}<input name="invite" id="invite${item.uuid}" class="notify-checkboxes" type="checkbox" value="${item.uuid}">#{/if} 
							    	</td>
							    	<td style="padding:3px;text-align:center"> 
							    		#{if item.result && item.result == 'accepted'}<span class="label label-success">accepted</span> #{/if}
							    		#{if item.result && item.result == 'declined'}<span class="label label-danger">declined</span> #{/if}
							    		#{if item.result == null}<span class="label label-default">waiting</span> #{/if}
							    	</td>
							    	<td style="padding:3px;text-align:center"> 
							    	#{if isOwner && item.paid}
							    		<span class="label label-default">paid</span>
							    	#{/if}
							    	</td>
							    	<td style="text-align:right">
							    		#{if user && item.email == user.login}
							    		<a class="" href="/attendance-new-edit?type=accepted&uuid=${item.uuid}&url=${request.url.urlEncode()}#invitation">
							    			<i class="fa fa-check color-link fa-1x"></i>
							    		</a>
							    		<a class="" href="/attendance-new-edit?type=declined&uuid=${item.uuid}&url=${request.url.urlEncode()}#invitation">
							    			<i class="fa fa-times color-link fa-1x"></i>
							    		</a>
							    		#{/if}
							    		#{if isOwner}
							    		<a class="" href="/attendance-new-delete?uuid=${item.uuid}&url=${request.url.urlEncode()}#invitation">
							    			<i class="fa fa-minus-square color-link fa-1x"></i>
							    		</a>
							    		#{/if}
							    	</td>
							    </tr>
							#{/list}							
						</table>
						#{if isOwner}
							<h3>Write message</h3>
							<div class="form-group" style="margin-bottom:5px;">			    
						    	<textarea rows="4" cols="" name="message" class="form-control" placeholder="Message" style="margin-top:5px"></textarea>
						    </div>
					        <button type="submit" class="pull-right btn btn-light-gray btn-short"><span class="spinner-small spinner-notify"> </span>&{'submit'}</button>
			  				<div class="clearfix"></div>
						#{/if}
	  				</form>					
					#{/if}
			</div>
  			<!-- guests -->				
			#{/if}

			#{include 'leftPanel.html' /}
		</div>
	</div>	
	<br/>
</div>
#{/if}



#{if !edit && event && event.listing.chatEnabled}
<script>
    star.user = '${name}';
    star.room = '${room}';
    star.server_host = '${serverIp}:8888';
    star.livestream = true;
    star.peerId = null;
</script>
<script src="https://${serverIp}:8888/socket.io/socket.io.js"></script>
<script src="@{'/public/javascripts/room.js'}" type="text/javascript"></script>
#{/if}	



