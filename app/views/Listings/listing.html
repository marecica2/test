#{extends 'main.html' /} 
#{set 'title'}
	#{if listing} ${listing.title} #{/if} #{if event} - ${event.eventStart.format("dd MMM")} #{time time:event.eventStart/} #{/if}
#{/set}

#{set 'moreScripts'}
	<script>
	starCalendar.aspectRatio = 2.5;
	star.dashboard = false;
	#{if user}
		star.user = "${user.uuid}";
	#{/if}
    #{if event}
       	starCalendar.event = "${event.uuid}" 
	#{/if}
	#{elseif listing}
    	starCalendar.listing = "${listing.uuid}";
    	starCalendar.user = "${listing.user.login}";	
	#{/elseif}
	#{else}
		starCalendar.temp = "${temp}";
	#{/else}	
	</script>	
	<script src="@{'/public/javascripts/lib/bootstrap-timepicker.min.js'}" type="text/javascript"></script>
	<script src="@{'/public/javascripts/lib/simpleWebRtc.js'}" type="text/javascript" ></script>
	<script src="@{'/public/javascripts/lib/bootstrap-datepicker.js'}" type="text/javascript"></script>	
	<script src="@{'/public/javascripts/utils.js'}" type="text/javascript"></script>	
	<script src="@{'/public/javascripts/starEvent.js'}" type="text/javascript"></script>	
	<script src="@{'/public/javascripts/upload.js'}" type="text/javascript"></script>	
	<script type="text/javascript" src="@{'/public/javascripts/lib/bootstrap-timepicker.min.js'}"></script>
	#{if listing}
	<script>
		$(document).ready(function(){
			var now = (new Date(new Date().getTime())).toJSON();
			
			var params = "&start="+now+"&end="+now+"&listing="+starCalendar.listing+"&user="+starCalendar.user+"&direction=upcoming&type=listing";
			star.initItems("Upcoming", params);
	
			var params1 = "&start="+now+"&end="+now+"&listing="+starCalendar.listing+"&user="+starCalendar.user+"&direction=previous&type=listing";
			star.initItems("Previous", params1);
		});
	</script>			
	#{/if}
#{/set}


#{set 'moreStyles'}
    <link href="@{'/public/css/bootstrap-timepicker.min.css'}" rel="stylesheet" media="screen"/>
    <link rel="stylesheet" type="text/css" href="@{'/public/css/tags.css'}" />
	<link rel="stylesheet" href="@{'/public/css/jquery.Jcrop.min.css'}" type="text/css" />
    <style>
    	.vertical-divider-right {
			padding-right: 15px !important;
    	}	
    	iframe[data-gapiattached="true"] {
    		position:relative !important;
    		top:10px !important;
    	}
    </style>
#{/set}

<!-- set the item object -->
#{if fromEvent && event}
	#{set item:event /}
	#{set globalObject:event /}
#{/if}
#{else}
	#{set item:listing /}
	#{set globalObject:listing /}
#{/else}

#{if listing}
	#{set usr:listing.user /} 
#{/if}
#{else}
	#{set usr:user /} 
#{/else}


<!-- Share Modal -->
<div class="modal" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">&{'cancel'}</span></button>
        <h3 class="modal-title" id="myModalLabel"><i class="fa fa-link"></i> &{'share'}</h3>
      </div>
      <div class="modal-body">
      	<input type="text" class="form-control share-link" value="${baseUrl + request.url}" onclick="javascript:$(this).select();">
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default btn-short" data-dismiss="modal">&{'close'}</button>
      </div>
    </div>
  </div>
</div>

<!-- Refund Modal -->
#{if fromEvent}
<div class="modal" id="refundModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <form method="POST" action="/paypal/refund/request/${attendance.uuid}?url=${request.url.urlEncode()}">
	  <div class="modal-dialog">
	    <div class="modal-content">
	      <div class="modal-header">
	        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">&{'cancel'}</span></button>
	        <h3 class="modal-title" id="myModalLabel">&{'request-refund'}</h3>
	      </div>
	      <div class="modal-body">
	      	<label>&{'refund-reason'}</label>
	      	<textarea rows="4" class="form-control" name="reason" placeholder="&{'write-reason'}" maxlength="500"></textarea>
	      </div>
	      <div class="modal-footer">
	        <button type="button" class="btn btn-default btn-short" data-dismiss="modal">&{'close'}</button>
	        <button type="submit" class="btn btn-default btn-short">&{'submit'}</button>
	      </div>
	    </div>
	  </div>
  </form>
</div>
#{/if}

#{set displayChat:true /}
#{set displayStream:true /}

<!-- Listing title controls -->
<div class="section gray-bg" style="padding-top:15px;padding-bottom:15px">
	<div class="container">
	   	<div class="pull-left">

		   	<h2 class="margin-clear">
		   		#{if listing}
			   		<a href="/channels?category=${listing.category}" class="anchor"><i>${listing.category.capAll()}</i></a> 
			   		&middot; <i><a class="anchor" href="/channel/${listing.uuid}">${listing.title}</a></i>
		   		#{/if}
		   		#{else}
		   			<i>&{'create-new-channel'}</i>
		   		#{/else}
		   		#{if event}
		   			<br/>
			   		<span style="font-size:0.5em;position:relative;bottom:3px">
				   		<span>${event.eventStart.format("dd MMM")}, </span>
				   		<span>#{time time:event.eventStart/}</span> - 
				   		<span>#{time time:event.eventEnd/}</span> &middot;		   		
				   		<span>${event.getMinutes()} min</span>		   		
			   		</span>
		   		#{/if}
		   	</h2>	
		   	
		   	#{include 'Listings/editButtons.html' /}
	   	</div>
		
		
		<!-- social -->
	   	<div class="pull-right">
			<ul class="social-links colored clearfix" style="margin:10px">
				<li class="dribbble"><a href="" data-toggle="modal" data-target="#myModal" ><i class="fa fa-link"></i></a></li>
				<li class="facebook">
					<a id="fb-share" href="#"><i class="fa fa-facebook"></i></a>
				<li class="twitter">
					<a id="twitter-share-button" href="#"><i class="fa fa-twitter"></i></a>
				</li>
				<li class="linkedin">
					<a id="linkedin-share-button" href="#" ><i class="fa fa-linkedin"></i></a>
				</li>
				<li class="googleplus">
					<a href="https://plus.google.com/share?url=${(request.base+request.url).urlEncode()}" onclick="javascript:window.open(this.href,
					  '', 'menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=600,width=600');return false;"><i class="fa fa-google-plus"></i></a>					
				</li>
			</ul>
	   	</div>
	   	#{if listing}
		<script>
			$("#fb-share").click(function(e){
			    e.preventDefault();
			    FB.ui(
			    {
				    method: 'feed',
				    name: '${listing.title}',
				    link: '${request.base}${request.url}',
				    picture: '${request.base}/${listing.imageUrl}',
				    caption: 'by ${listing.user.fullName}',
				    description: "${listing.description.escapeJavaScript().raw()}",
				    message: ''
			    });
			});		
			$("#twitter-share-button").click(function(e){
			    e.preventDefault();
			    var width  = 400,
		        height = 400,
		        left   = ($(window).width()  - width)  / 2,
		        top    = ($(window).height() - height) / 2,
		        url    = this.href,
		        opts   = 'status=1' +
		                 ',width='  + width  +
		                 ',height=' + height +
		                 ',top='    + top    +
		                 ',left='   + left;
			    var url = "https://twitter.com/share?text=${listing.title}";
		    	window.open(url, 'twitter', opts);						    
			})	
			
			$("#linkedin-share-button").click(function(e){
			    e.preventDefault();
			    var width  = 400,
		        height = 400,
		        left   = ($(window).width()  - width)  / 2,
		        top    = ($(window).height() - height) / 2,
		        url    = this.href,
		        opts   = 'status=1' +
		                 ',width='  + width  +
		                 ',height=' + height +
		                 ',top='    + top    +
		                 ',left='   + left;
			    var url = "//www.linkedin.com/shareArticle?mini=true&url=${request.url.urlEncode()}&title=${listing.title}&summary=${listing.description.escapeJavaScript().raw()}&source=${request.url}";
		    	window.open(url, 'linkedin', opts);						    
			})
		</script>	 
		#{/if}  	
	   	<div class="clearfix"></div>
	   	
	   	
		
	</div>
</div>
<!-- listing title controls -->






<!-- header image -->
<div class="section dark-bg" style="padding:0px;">
	<div class="container">	
		<div class="row">
			<div class="col-md-12 " style="padding:0px;">

				#{if edit}
					<!-- background image -->
					#{if listing}
						<div class="avatar-container">
						  	<img id="image" class="" style="width:100%" src="/${listing.imageUrl}">
						</div>					
					#{/if}
					#{elseif request.params.imageUrl}
						<div class="avatar-container">
					  		<img id="image" class="cropper" style="width:100%" src="/${request.params.imageUrl}">
						</div>								
					#{/elseif}
					#{else}
						<div class="avatar-container">
							<img id="image" class="" style="width:100%" src="/public/images/no_image.png">	
						</div>								
					#{/else}
					<!-- background image -->
				#{/if}
	
				#{else}
					#{if displayStream}
						#{include 'Listings/stream.html' /}
					#{/if}
					#{else}
						<div id="image"style="overflow: hidden;width:100%;height:400px;background: url(/${listing.imageUrl}) center; background-size: cover;text-align:center">
							<div class="shadow-inset" style="height:130%;position:relative;top:-60px;"></div>
							#{if listing && listing.video}
								<a style="position:absolute;top:50%;left:43%" class="popup-iframe text-shadow" href="${listing.video}"><i class="fa fa-youtube-play fa-3x"></i><br/>&{'play-introduction'}</a>
							#{/if}
						</div>		
					#{/else}				
				#{/else}				
			</div>
		</div>
	</div>
</div>
<!-- header -->





<!-- edit -->
#{include 'Listings/edit.html' /}
<!-- edit -->




<!-- parallax -->
#{if !edit}
<div class="section parallax default-translucent-bg parallax-bg-2" style="">
	<div class="container">
		<div class="row">
			<div class="col-md-8">
				<h2 class="title text-center text-shadow" style="font-size:2.5em">
					<a class="anchor2" href="/channel/${listing.uuid}">${listing.title}</a>		
				</h2>
				<h5 class="text-center text-shadow" >
					<span>
						#{if event && fromEvent}
							#{if item && item.charging == 'free'}
								<strong>&{'free'}</strong>
							#{/if}
							#{else}
								<strong>&{'total-price'}: ${event.getTotalPrice()} ${event.currency} for ${event.getMinutes()} &{'min'}</strong>							
								#{if !fromEvent && listing.firstFree}
									<span class="label btn-dark">&{'first-event-is-free'}</span>
								#{/if}
							#{/else}
							
						#{/if}
						#{else}
							#{if listing && listing.charging == 'free'}
								<strong>&{'free'}</strong>
							#{/if}						
							#{else}
								<strong>&{'from'} ${listing.price} ${item.currency}</strong>
								<strong>for ${listing.chargingTime} &{'min'}</strong>
								#{if listing.firstFree}
									<span class="label btn-dark">&{'first-event-is-free'}</span>
								#{/if}
							#{/else}	
						#{/else}
					
					</span>				
				</h5>
			</div>
			<div class="col-md-4">
				#{if !isOwner && listing.user.account.type == "publisher"}
				<div class="text-center">
					<a href="/user/${usr.login}"><img style="height:61px;" src="/${usr.avatarUrl}_64x64"></a>				
					<a href="/user/${usr.login}/calendar?channel=${listing.uuid}" class="btn btn-dark btn-lg"><i class="fa fa-calendar"></i> &{'request-for-event'}</a>
				</div>
				#{/if}
			</div>
		</div>
	</div>
</div>
#{/if}
<!-- parallax -->

	
	
#{if !edit}
<div class="container">		
	<br/>
	<div class="row">

		<div class="col-md-4 col-md-push-8">
			<a name="invitation"></a>
			#{if comments}
			<div style="width:100%; padding:0px">
				#{list items:comments, as:'item'}
					#{list items:item.files, as:'file'}
						#{if file.isImage()}
							<span style="float:left;" title="${file.name}">
							<span class="overlay-container">
								<img src="/public/uploads/${file.url}" style="height:62px" alt="${file.name}">
								<a href="/public/uploads/${file.url}" class="overlay small popup-img">
									<i class="fa fa-search-plus"></i>
								</a>
							</span>		
							</span>		
						#{/if}
					#{/list}
				#{/list}
				<div class="clearfix"></div>
			</div>
			#{/if}		
		
			#{if fromEvent && !edit}
			<!-- guests -->
			<div>
				<h2>
					<label style="font-weight:500" for="notify-check-all">&{'guests'}</label>
					#{if isOwner}
						<input id='notify-check-all' type='checkbox' style='position:relative;top:2px;' class='notify-check-all' value='all'>
					#{/if}
				</h2>
				<div class="separator-2"></div>
				
				#{if false && event && (attendance == null || !attendance.watchlist)}
					<a href="/watchlist/add?event=${event.uuid}&url=${request.url.urlEncode()}" class="btn btn-light-gray btn-sm margin-clear">
						<i class="dialog-event-edit color-link fa fa-plus fa-1x"></i> &{'add-to-watchlist'}
					</a>
				#{/if}
				
				#{if false && attendance != null && attendance.watchlist}
					<a href="/watchlist/remove?id=${attendance.uuid}&url=${request.url.urlEncode()}" class="btn btn-light-gray btn-sm margin-clear">
						<i class="dialog-event-edit color-link fa fa-minus fa-1x"></i> &{'remove-from-watchlist'}
					</a>
				#{/if}				
				
				#{if isOwner}
	 				<form class="" action="/attendance-new-save?eventId=${event.uuid}&url=${request.url.urlEncode()}#invitation" method="post">
					    <div class="input-group" style="width:100%">
							<input type="text" class="form-control" autocomplete="off" placeholder="&{'contact-name-or-email'}" maxlength="50" name="email" id="dialog-invite-input" data-provide="typeahead">
						    <span class="input-group-btn">
						    	<button class="btn btn-default btn-short" style="margin:0px;height:40px" id="dialog-invite-button" type="submit">&{'add'}</button>
						    </span>
					    </div>
						<div class="error">#{error 'email' /}</div>
						<script>
						        $(".notify-check-all").change(function(){
						            if($(this).prop("checked")){
						                $('.notify-checkboxes').prop("checked", true);
						            } else {
						                $('.notify-checkboxes').prop("checked", false);
						            }
						        });
						    				      
							  	$("#dialog-invite-input").typeahead(
							  	{
							  	    minLength : 2, 
							  	    source : function(value, process){
										  	    $.get("/invites?str="+value, function(data){
										  	        var list = [];
											  	    for(var i in data)
												  		list.push(data[i].login +", "+ data[i].name);
										  	        process(list);
										  	    });
							  				},
							  		updater : function(item){
							  		    return item.substring(0, item.indexOf(", "));
							  		}, 
							  		matcher : function(item){
							  		    return true;
							  		}
							  	}
							  	);
						</script>
	  				</form>
					#{/if}					

					#{if event && event.attendances}
	  				<form action="/event/invite?eventId=${event.uuid}&url=${request.url.urlEncode()}" method="post">
						<table class="dialog-invite-list" data-checkboxes="true" style="width:100%">
							#{list items:event.attendances, as:'item'}
							    <tr>
							    	<td>
							    		#{if item.isForUser && item.user != null}
								    		<img class="avatar22 img-circle"  src="/${item.user.avatarUrl}"> <label class="light" for="invite${item.uuid}"><a href="/user/${item.user.login}">${item.user.fullName}</a></label>
										#{/if}
										#{elseif item.customer != null}
								    		<img class="avatar22 img-circle"  src="/${item.customer.avatarUrl}"> <label class="light" for="invite${item.uuid}"><a href="/user/${item.customer.login}">${item.customer.fullName}</a></label>
										#{/elseif}
										#{else}
								    		<img class="avatar22 img-circle"  src="/public/images/avatar_32x32"> <label for="invite${item.uuid}">${item.email}</label>
										#{/else}
							    		#{if isOwner && (item.user == null || !item.isForUser)}<input name="invite" id="invite${item.uuid}" class="notify-checkboxes" type="checkbox" value="${item.uuid}">#{/if} 
							    	</td>
							    	<td style="padding:3px;text-align:center"> 
							    		#{if item.result && item.result == 'accepted'}<span class="label default-bg">&{'accepted'}</span> #{/if}
							    		#{if item.result && item.result == 'declined'}<span class="label label-danger">&{'declined'}</span> #{/if}
							    		#{if item.result == null}<span class="label label-default">&{'waiting'}</span> #{/if}
							    	</td>
							    	<td style="padding:3px;text-align:center"> 
							    	#{if isOwner && item.paid}
							    		<span class="label label-success">&{'paid'}</span>
							    	#{/if}
							    	</td>
							    	<td style="text-align:right">
							    		#{if user && item.email == user.login}
							    		<a class="" href="/attendance-new-edit?type=accepted&uuid=${item.uuid}&url=${request.url.urlEncode()}#invitation">
							    			<i class="fa fa-check color-link fa-1x"></i>
							    		</a>
							    		#{/if}
							    		#{if (user && item.email == user.login && !isOwner) || (isOwner && user && item.email != user.login)}
							    		<a class="" href="/attendance-new-delete?uuid=${item.uuid}&url=${request.url.urlEncode()}#invitation">
							    			<i class="fa fa-times color-link fa-1x"></i>
							    		</a>
							    		#{/if}
							    	</td>
							    </tr>
							#{/list}							
						</table>
						#{if isOwner}
							*{
							<h3>&{'write-custom-message'}</h3>
							<div class="form-group" style="margin-bottom:5px;">			    
						    	<textarea rows="4" cols="" name="message" class="form-control" placeholder="Message" style="margin-top:5px"></textarea>
						    </div>
						    }*
					        <button type="submit" class="pull-right btn btn-light-gray btn-short"><span class="spinner-small spinner-notify"> </span>&{'notify'}</button>
			  				<div class="clearfix"></div>
						#{/if}
	  				</form>					
					#{/if}
			</div>
  			<!-- guests -->				
			#{/if}

			#{set mail:true /}
			#{include 'leftPanel.html' /}
		</div>

		<div class="col-md-8 col-md-pull-4" >
			<!-- description -->
			<div>
    	   	   <h2>
					#{if listing}
    	   	   			${listing.title}
	 	    	   	#{/if}

					#{if stats}
						<a href="#reviews" style="font-size:0.3em;text-decoration: none">
				       		#{list items:1..5, as:'i'} 
				       			#{if stats.get("avgStars") >= i}
								    <i class="fa fa-star fa-2x text-default" data-value="1"></i>
				       			#{/if}
				       			#{else}
								    <i class="fa fa-star-o fa-2x" data-value="1"></i>
				       			#{/else}
							#{/list}
						</a>
	    	   	   	#{/if}
    	   	   	</h2>
    	   	   	<div class="separator-2"></div>
    	   	   	<strong><a href="/user/${listing.user.login}"><img class="avatar16 img-circle" src="/${listing.user.avatarUrl}_32x32"> <span>${listing.user.fullName}</span></a></strong> 
    	   	 	&middot;

 	    	   	<span>
					#{if fromEvent && event}
						#{if event.privacy == 'private'}
							<span class="labels "><i class="fa fa-lock"></i> &{event.privacy}</span> &middot;
						#{/if}
						
						#{if event.privacy == 'public'}
							<span class="labels "><i class="fa fa-unlock"></i> &{event.privacy}</span> 
						#{/if}
						
						<span class="labels "><i class="fa fa-comments"></i> &{event.type}</span> 

					#{/if}		 	    	   	
					#{else}
						#{if listing.privacy == 'private'}
							<span class="labels "><i class="fa fa-lock"></i> &{listing.privacy}</span> &middot;
						#{/if}
						
						#{if listing.privacy == 'public'}
							<span class="labels "><i class="fa fa-unlock"></i> &{listing.privacy}</span> &middot;
						#{/if}
						
						<span class="labels "><i class="fa fa-comments"></i> &{listing.type}</span>
					#{/else}		    	   
	    	   	</span>
    	   	   	
				<p>${listing.getDescriptionHtml().raw()}</p>
    	   		#{if listing && listing.tags}
	    		    #{set tags = listing.tags.split(",") /}
	    	    	#{list items:tags, as:'tag'}
	    	    		<a href="/channels?search=${tag}" style="font-size:0.8em" class="label label-default">${tag}</a>
	    	    	#{/list}
    	    	#{/if}
			</div>


			<!-- comments -->
			<div>
				<!-- comments -->
				#{if fromEvent}
					#{set objectType:"event" /}
					#{set object:event /}
					#{include 'comments.html' /}			
				#{/if}
				#{else}
					#{set objectType:"listing" /}
					#{set object:listing /}
					#{include 'comments.html' /}			
				#{/else}
			</div>		
			
			
			<!-- listing events -->
			#{if !fromEvent}
			<div>
				<div class="pull-left containerUpcoming" style="display:none;margin-top:20px;text-align:center;width:50%;padding-right:7px">
					<h3>
						&{'upcoming-events'}
					</h3>
					<div id="itemsListUpcoming" class="full-width"></div>
					<div class="spinner-container1">
						<div class="spinner-container">
							<div id="spinnerUpcoming" class="spinner-load"></div>
							<a id="moreResultsUpcoming" class="spinner-more"><i class=" icon-plus-circled"></i></a>
						</div>
					</div>
				</div>
				<div class="pull-left containerPrevious" style="display:none;margin-top:20px;text-align:center;width:50%;padding-left:7px">
					<h3>
						&{'recent-events'}
					</h3>
					<div id="itemsListPrevious" class="full-width"></div>
					<div class="spinner-container1">
						<div class="spinner-container">
							<div id="spinnerPrevious" class="spinner-load"></div>
							<a id="moreResultsPrevious" class="spinner-more"><i class=" icon-plus-circled"></i></a>
						</div>
					</div>
				</div>	
			</div>	
			<div class="clearfix"></div>
			#{/if}
			
			

			<!-- user about -->
			<div>
				<br/>
				<h2><a class="anchor" href="/user/${listing.user.login}"><img class="img-circle" src="/${listing.user.avatarUrl}_32x32"> &{'about'} ${listing.user.firstName}</a></h2>
				<div class="separator-2"></div>
				#{if listing}
					#{set usr: listing.user /}
				#{/if}		
				#{else}		
					#{set usr: user /}
				#{/else}		
					
				#{include 'userAbout.html' /}
			</div>	
						
			<!-- listings -->
			<div>
				<br/>			
				#{if listings}
					<h2>&{'all-channels-from'} ${listing.user.firstName}</h2>
					<div class="separator-2"></div>
					#{set items:listings /}
					#{set forEvents:false /}
					#{include 'listingsList.html' /}
				#{/if}	
			</div>
			<!-- listings -->	

			<!-- ratings -->
			<div>
				#{if listing}
					#{set object:listing /}
					#{set ratingType:"listing" /}
				#{/if}
				#{include 'ratings.html' /}				
			</div>		
			<!-- ratings -->

		</div>
	
	</div>	
	<br/>
</div>
#{/if}


#{if !edit && globalObject && (globalObject.chatEnabled || globalObject.type == "instant")}
<script>
    star.user = '${name}';
    star.room = '${room}';
    star.userInRoom = false;
    star.server_host = '${socketIo}';
    star.livestream = true;
    star.peerId = null;
</script>
<script src="${socketIo}/socket.io/socket.io.js"></script>
<script src="@{'/public/javascripts/room.js'}" type="text/javascript"></script>
#{/if}	



